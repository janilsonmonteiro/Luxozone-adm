<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="shortcut icon" href="logo2.png" type="image/x-icon">
<title>Upload Múltiplo → Luxzone-Admin</title>

<style>
    section{
        text-align: center;
        border: solid 4px #00b8dd23;
        padding: 20px;
        margin: 10px;
        border-radius: 20px;
    }
    #inome,#ipass{
        min-width: 230px;
        margin: 10px;
        padding: 10px;
        width: 40%;
        display: inline-block;
        background-color: #0f0f11;
        color: #00d4ff;
        border: solid 3px #00b8dd3f;
        border-radius: 5px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #0f0f11;
        color: #e0e0e0;
        padding: 30px;
        min-height: 100vh;
    }
    .container { max-width: 900px; margin: 0 auto; }
    h1 { color: #00d4ff; margin-bottom: 8px; font-size: 2.4rem; text-align: center; }
    .subtitle { color: #888; text-align: center; margin-bottom: 40px; }
    .upload-area {
        border: 3px dashed #444;
        border-radius: 16px;
        padding: 60px 20px;
        text-align: center;
        transition: all 0.25s;
        background: #16181d;
        margin-bottom: 30px;
        cursor: pointer;
    }
    .upload-area:hover, .upload-area.dragover {
        border-color: #00d4ff;
        background: #1a1d24;
    }
    .upload-area p { margin: 15px 0; color: #aaa; }
    input[type="file"] { display: none; }
    button {
        background: #00d4ff;
        color: black;
        border: none;
        padding: 14px 32px;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
        margin: 10px;
    }
    button:hover { background: #00b8dd; transform: translateY(-2px); }
    .result-area { margin-top: 40px; }
    .image-item {
        background: #1a1d24;
        padding: 16px;
        border-radius: 10px;
        margin-bottom: 14px;
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }
    .image-item img {
        max-width: 120px;
        max-height: 120px;
        border-radius: 8px;
        object-fit: cover;
    }
    .url-container { flex: 1; min-width: 280px; }
    input.url-input {
        width: 100%;
        padding: 10px 14px;
        background: #0f0f11;
        border: 1px solid #333;
        border-radius: 8px;
        color: white;
        font-family: monospace;
    }
    .copied { background: #28a745 !important; color: white !important; }
</style>
</head>
<body>

<div class="container">
    <h1>Upload Múltiplo → Luxzone-Admin</h1>
    <section>
        <label for="inome">
            Digite o nome do carro:
        </label>
        <input type="text" placeholder="Digite o nome do carro" id="inome">
        <br>
        <label for="ipass">Numero de passagesiros:</label>
        <input type="number" name="" id="ipass" placeholder="Numero de passageiros">
    </section>
    <p class="subtitle">Selecione várias imagens → URLs diretas instantâneas</p>

    <div class="upload-area" id="dropArea">
        <p>Clique aqui ou arraste as imagens</p>
        <p style="font-size:0.9em; color:#666;">(jpg, png, gif, webp — até 32 MB cada)</p>
        <input type="file" id="fileInput" multiple accept="image/*">
    </div>

    <div style="text-align:center; margin:30px 0;">
        <button id="uploadBtn">Fazer Upload de Tudo</button>
        <button id="clearBtn" style="background:#444; color:#ddd;">Limpar tudo</button>
    </div>

    <div class="result-area" id="results"></div>
</div>

<script>
// ← COLOQUE SUA API KEY AQUI ↓↓↓
const API_KEY = '95aac3b7a4fee695a053812300965e9f';   // ← substitua isso pela sua key real!

const dropArea = document.getElementById('dropArea');
const fileInput = document.getElementById('fileInput');
const uploadBtn = document.getElementById('uploadBtn');
const clearBtn = document.getElementById('clearBtn');
const results = document.getElementById('results');

let selectedFiles = [];

// Clique na área
dropArea.addEventListener('click', () => fileInput.click());

// Seleção de arquivos
fileInput.addEventListener('change', handleFiles);

// Drag & Drop
dropArea.addEventListener('dragover', e => { e.preventDefault(); dropArea.classList.add('dragover'); });
dropArea.addEventListener('dragleave', () => dropArea.classList.remove('dragover'));
dropArea.addEventListener('drop', e => {
    e.preventDefault();
    dropArea.classList.remove('dragover');
    handleFiles(e.dataTransfer.files);
});

function handleFiles(files) {
    if (!files) return;
    if (typeof files.length === 'undefined') files = files.target.files;

    selectedFiles = [...selectedFiles, ...Array.from(files)];
    showPreview();
}

function showPreview() {
    results.innerHTML = '';
    selectedFiles.forEach((file, index) => {
        const item = document.createElement('div');
        item.className = 'image-item';
        item.innerHTML = `
            <img id="preview-${index}">
            <div class="url-container">
                <input type="text" class="url-input" readonly value="Aguardando upload..." id="url-${index}">
                <div style="margin-top:8px;">
                    <button class="copy-btn" data-id="${index}">Copiar URL</button>
                </div>
            </div>
        `;
        results.appendChild(item);

        const reader = new FileReader();
        reader.onload = e => document.getElementById(`preview-${index}`).src = e.target.result;
        reader.readAsDataURL(file);
    });
}

// Upload
uploadBtn.addEventListener('click', async () => {
    if (selectedFiles.length === 0) return alert("Selecione pelo menos uma imagem!");
    if (API_KEY != '95aac3b7a4fee695a053812300965e9f') return alert("Coloque sua API key real no código primeiro!");
    let name=document.getElementById("inome").value
    let pass=document.getElementById("ipass").value
    if (name=="") return alert("Adicione o nome do carro")
    if (pass=="") return alert("Adicione o numero de passageiros")
    name=String(name).toLowerCase().replaceAll(" ","_")
    pass+=' passengers'
    
    uploadBtn.disabled = true;
    uploadBtn.textContent = "Enviando...";
    let lista=[]

    for (let i = 0; i < selectedFiles.length; i++) {
        const file = selectedFiles[i];
        const urlInput = document.getElementById(`url-${i}`);
        urlInput.value = "Enviando...";

        try {
            
            const url = await uploadToImgBB(file);
            urlInput.value = url;
            lista.push(url)
            
        } catch (e) {
            urlInput.value = "Erro :(";
            console.error(e);
        }
    }

    await getAll(lista,name,pass)
    uploadBtn.disabled = false;
    uploadBtn.textContent = "Fazer Upload de Tudo";
    console.log("---",selectedFiles)
});

async function uploadToImgBB(file) {
    const formData = new FormData();
    formData.append('image', file);
    formData.append('key', API_KEY);
    // Opcional: formData.append('expiration', '600'); // expira em 10 min (em segundos) — remova se quiser permanente

    const response = await fetch('https://api.imgbb.com/1/upload', {
        method: 'POST',
        body: formData
    });

    const data = await response.json();

    if (data.success) {
        return data.data.url;  // URL direta da imagem
        // Alternativas: data.data.display_url, data.data.thumb (miniatura)
    }

    throw new Error(data.error?.message || "Falha no upload");
}

// Copiar
document.addEventListener('click', e => {
    if (e.target.classList.contains('copy-btn')) {
        const id = e.target.dataset.id;
        const input = document.getElementById(`url-${id}`);
        input.select();
        document.execCommand('copy');

        const original = e.target.textContent;
        e.target.textContent = "Copiado ✓";
        e.target.style.background = '#28a745';
        e.target.style.color = 'white';

        setTimeout(() => {
            e.target.textContent = original;
            e.target.style.background = '';
            e.target.style.color = '';
        }, 2000);
    }
});

// Limpar
clearBtn.addEventListener('click', () => {
    if (confirm("Limpar tudo?")) {
        selectedFiles = [];
        results.innerHTML = '';
        fileInput.value = '';
    }
});

async function getAll(lista_,nome,pass){
    let lista={}
    let i=1
    lista_.map((e)=>{
        lista[`a${i}`]=e
        i++
    })
    lista.pass=pass
    console.log(lista,nome)
    await atualizarLuxo(lista,nome)
    

}



// ================= CONFIG =================
    const GITHUB_TOKEN = "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";
    const OWNER = "janilsonmonteiro"; // ex: janilsonmp
    const REPO = "Luxzone";
    const FILE_PATH = "luxo_.json";
    const BRANCH = "main";
    // ==========================================

    async function atualizarLuxo(novoJson,nome) {
      const url = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FILE_PATH}`;

      const headers = {
        "Authorization": `Bearer ${GITHUB_TOKEN}`,
        "Accept": "application/vnd.github+json",
        "Content-Type": "application/json"
      };

      try {
        // 1️⃣ Buscar o JSON atual
        const res = await fetch(url, { headers });
        const data = await res.json();

        if (!data.content) {
          alert("Arquivo não encontrado");
          return;
        }

        // 2️⃣ Decodificar Base64
        const originalJson = JSON.parse(
          atob(data.content)
        );

        // 3️⃣ Novo JSON para juntar

        // 4️⃣ Juntar
        originalJson[0][nome]=novoJson
        const jsonFinal =originalJson;


        // 5️⃣ Converter para Base64
        const contentBase64 = btoa(
          JSON.stringify(jsonFinal, null, 2)
        );

        // 6️⃣ Atualizar no GitHub
        const update = await fetch(url, {
          method: "PUT",
          headers,
          body: JSON.stringify({
            message: "update luxo_.json via site privado",
            content: contentBase64,
            sha: data.sha,
            branch: BRANCH
          })
        });

        if (update.ok) {
          alert("✅ luxo_.json atualizado com sucesso!");
        } else {
          const err = await update.json();
          alert("❌ Erro: " + err.message);
        }

      } catch (e) {
        alert("❌ Falha: " + e.message);
      }
    }
</script>
</body>

</html>

